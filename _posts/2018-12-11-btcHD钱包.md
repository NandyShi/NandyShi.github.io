---
layout:     post
title:      btcHD钱包
subtitle:   
date:       2018-12-11
author:     NandyShi
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - Bip32
	- Bip39
---
## 关于 Bitcoin 的钱包
在 Bitcoin 中有两种主要类型的钱包，分别为：

1. **非确定性钱包（Nodeterministic Wallet）**：该钱包中的每个密钥都是从不同的随机数独立生成的，密钥彼此之间没有任何关系，这种钱包也被称为 JBOK 钱包（Just a Bunch Of Keys）；
2. **确定性钱包（Deterministic Wallet）**：其中所有的密钥都是从一个主密钥派生出来的，这个主密钥就是种子（seed），在该类型的钱包中，所有的密钥之间都是相互关联的，如果有原始种子，就可以再次生成全部的密钥；在确定性钱包中，可以使用不同的密钥推导方式。目前最常用的推导方法是 树状结构，也称为 分层确定性钱包 或 HD 钱包；

我们文章的目的就是生成 HD 钱包，HD 钱包 可以允许用户在不安全的服务器上使用，或者在每笔交易中使用不同的公钥。

涉及到钱包的一些常用标准规范有：

- BIP-39: 助记词
- BIP-32：HD 钱包
- BIP-43：多用途 HD 钱包结构
- BIP-44：多币种和多账户钱包
要生成钱包私钥，我们需要有个种子(seed)，而我们这里是通过助记词来生成的，下面我们就先了解一下如何基于 BIP-39 规范来生成助记词和种子(seed)。

## 关于 BIP-39
BIP-39 规范主要描述了基于助记词（一组便于记忆的单词）来生成确定性钱包的算法和过程。

该规范中主要由两部分构成：

1.如何生成助记词；
2.如何将生成的助记词转化成一个二进制种子；
下面就先分别介绍这两个部分来看看如何生成确定性钱包。
>后面涉及到一些示例代码都是采用的 python-mnemonic 库。

## 生成助记词
生成助记词的算法过程如下图：
![](https://i.loli.net/2018/12/10/5c0e5ac5d771c.jpg)

具体过程如下：

1. 创建一个 128 到 256 位（步长 32 位）的随机序列（熵）；
> 随机序列的长度称为 熵长，熵长按照步长 32 位，主要有几种分别为 [128, 160, 192, 224, 256]，我们示例图中是 128 位；
2. 对上一步生成的随机序列进行 SHA256 生成 Hash 值，并取出该 Hash 值的前 N 位（熵长/32，如：128 位，则 N = 4）作为随机序列的校验和（Checksum）；
3. 将 Checksum 添加至第一步生成的随机序列的尾部，此时对于图中示例加上 Checksum 之后为 128 + 4 = 132 位的随机序列；
4. 将上一步的随机序列按照 11 位一段进行分隔(split)，这样对于 128 位熵长的序列就会生成 12 段（132/11=12）；
5. 此时将每个包含 11 位部分的值与一个预定义的 2048 个单词的词典进行对应；
6. 按照切割顺序生成了最终的单词组就是助记词；
可以看到不同熵长对应的 Checksum 的长度，最终生成的助记词的长度不同，具体如下表：


### 参考

- [精通比特币第二版](https://github.com/bitcoinbook/bitcoinbook)
- [比特币开发指南](https://bitcoin.org/en/developer-guide)

 


